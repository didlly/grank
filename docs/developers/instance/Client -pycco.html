<!DOCTYPE html>
<html>
 <head>
  <meta content="text/html;charset=utf-8" http-equiv="content-type"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Client.py
  </title>
  <link href="/grank/docs/assets/img/favicon.png" rel="shortcut icon"/>
  <link href="/grank/docs/assets/css/pycco.css" rel="stylesheet"/>
 </head>
 <body>
  <div id="container">
   <div id="background">
   </div>
   <div class="section">
    <div class="docs">
     <h1>
      Client.py
     </h1>
    </div>
   </div>
   <div class="clearall">
    <div class="section" id="section-0">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-0">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre><span></span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">uniform</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span><span class="p">,</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">instance.Exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ButtonInteractError</span><span class="p">,</span>
    <span class="n">DropdownInteractError</span><span class="p">,</span>
    <span class="n">MessageSendError</span><span class="p">,</span>
    <span class="n">ResponseTimeout</span><span class="p">,</span>
    <span class="n">WebhookSendError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">utils.Console</span> <span class="kn">import</span> <span class="n">fore</span><span class="p">,</span> <span class="n">style</span>
<span class="kn">from</span> <span class="nn">utils.Converter</span> <span class="kn">import</span> <span class="n">DictToClass</span>
<span class="kn">from</span> <span class="nn">utils.Merge</span> <span class="kn">import</span> <span class="n">combine</span>
<span class="kn">from</span> <span class="nn">utils.Requests</span> <span class="kn">import</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">utils.Shared</span> <span class="kn">import</span> <span class="n">data</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-1">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-1">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre><span class="k">class</span> <span class="nc">Instance</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-2">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-2">
        #
       </a>
      </div>
      <p>
       The
       <strong>
        init
       </strong>
       function is called when an instance of a class is created.
It initializes the attributes of the class.
      </p>
      <p>
       <b>Args:</b><br>
self: Gives access to the class' attributes and methods.
cwd (str): The current working directory of the program
account (DictToClass): The account's data class
      </p>
      <p>
       <b>Returns:</b><br>
NoneType:
       <strong>
        init
       </strong>
       functions for classes aren't allowed to return anything, don't ask me why
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cwd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="n">DictToClass</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-3">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-3">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span> <span class="o">=</span> <span class="n">cwd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avatar</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">avatar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">account</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">account</span><span class="o">.</span><span class="n">discriminator</span><span class="si">}</span><span class="s2">"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discriminator</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">discriminator</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-4">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-4">
        #
       </a>
      </div>
      <p>
       Set startup_time to the UNIX time the line was executed
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="bp">self</span><span class="o">.</span><span class="n">startup_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">())</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-5">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-5">
        #
       </a>
      </div>
      <p>
       Create the log file
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">cwd</span><span class="si">}</span><span class="s2">logs/</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">'version'</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">account</span><span class="o">.</span><span class="n">token</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">-%H-%M-%S'</span><span class="p">)</span><span class="si">}</span><span class="s2">.log"</span><span class="p">,</span>
            <span class="s2">"a"</span><span class="p">,</span>
            <span class="n">errors</span><span class="o">=</span><span class="s2">"ignore"</span><span class="p">,</span>
        <span class="p">)</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-6">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-6">
        #
       </a>
      </div>
      <p>
       Initialize the session stats dictionary in the shared dictionary
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="n">data</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"commands_ran"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">"buttons_clicked"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">"dropdowns_selected"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">"coins_gained"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">"items_gained"</span><span class="p">:</span> <span class="p">{},</span>
        <span class="p">}</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-7">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-7">
        #
       </a>
      </div>
      <p>
       The _update function is called every 10 seconds when the bot is being run. It updates the lifetime stats of the account, and adds their current session's stats to them.
      </p>
      <p>
       <b>Args:</b><br>
self: Gives access to the class' attributes and methods.
      </p>
      <p>
       <b>Returns:</b><br>
bool: Indicates whether the subprogram executed successfully or not
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-8">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-8">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="s2">"commands_ran"</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">][</span>
            <span class="s2">"commands_ran"</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="s2">"buttons_clicked"</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">][</span>
            <span class="s2">"buttons_clicked"</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="s2">"dropdowns_selected"</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">token</span>
        <span class="p">][</span><span class="s2">"dropdowns_selected"</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="s2">"coins_gained"</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">][</span>
            <span class="s2">"coins_gained"</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="s2">"items_gained"</span><span class="p">]</span> <span class="o">=</span> <span class="n">combine</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="s2">"items_gained"</span><span class="p">],</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">][</span><span class="s2">"items_gained"</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">info_write</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">True</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-9">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-9">
        #
       </a>
      </div>
      <p>
       The _update_coins function is used to update the coins_gained integer in the info file
It takes two arguments, command and coins. Command is the name of the command that was run, while coins is an integer representing how many coins were gained or lost by running said command.
      </p>
      <p>
       <b>Args:</b><br>
self: Gives access to the class' attributes and methods.
command (str): The command ran which was used to gain the coins
coins (int): The amount of coins received from the command
      </p>
      <p>
       <b>Returns:</b><br>
True if the coins received from the command is a number and less than 10000, else False
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>    <span class="k">def</span> <span class="nf">_update_coins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">coins</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-10">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-10">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="k">try</span><span class="p">:</span>
            <span class="n">coins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">coins</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">","</span><span class="p">,</span> <span class="s2">""</span><span class="p">))</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coins</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span> <span class="k">else</span> <span class="n">coins</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="s2">"WARNING"</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">"An error occured while parsing the coins received from the `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">` command - `</span><span class="si">{</span><span class="n">coins</span><span class="si">}</span><span class="s2">` is not a number."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">coins</span> <span class="o">&gt;</span> <span class="mi">10000</span> <span class="ow">and</span> <span class="n">command</span> <span class="o">!=</span> <span class="s2">"pls blackjack"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="s2">"WARNING"</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">"A possible error was encountered while parsing the coins received from the `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">` command - `</span><span class="si">{</span><span class="n">coins</span><span class="si">}</span><span class="s2">` is a large amount."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">coins</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">][</span><span class="s2">"coins_gained"</span><span class="p">]</span> <span class="o">+=</span> <span class="n">coins</span>

        <span class="k">return</span> <span class="kc">True</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-11">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-11">
        #
       </a>
      </div>
      <p>
       The _update_items function is used to update the
       <code>items_gained</code>   dictionary in the info file.
It takes two arguments: command and item.
command is a string that represents what command was run (e.g.,
       <code>beg</code> or
       <code>crime</code>).
item is a string representing which item was gained (e.g.,
       <code>apple</code>,
       <code>fish</code>).
      </p>
      <p>
       <b>Args:</b><br>
       <br>
self: Gives access to the class' attributes and methods.
command (str): The command ran which was used to gain the item
item (int): The item received from that command.
      </p>
      <p>
       <b>Returns:</b><br>
False if the item is an empty string, has
       <code>answered first</code> in it, is
       <code>no items</code> or is
       <code>the shop sale just started!</code>, else True
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>    <span class="k">def</span> <span class="nf">_update_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-12">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-12">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">""</span><span class="p">,</span>
            <span class="s2">"no items"</span><span class="p">,</span>
            <span class="s2">"your immune system is under attack from covid-19"</span><span class="p">,</span>
            <span class="s2">"the shop sale just started!"</span> <span class="ow">or</span> <span class="s2">"answered first"</span> <span class="ow">in</span> <span class="n">item</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="s2">"WARNING"</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">"A possible error was encountered while parsing the items received from the `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">` command - `</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">` seems to be more than 3 words."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">char</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">item</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="s2">"WARNING"</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">"A possible error was encountered while parsing the items received from the `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">` command - `</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">` seems to contain digits."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">][</span><span class="s2">"items_gained"</span><span class="p">]:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">][</span><span class="s2">"items_gained"</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">][</span><span class="s2">"items_gained"</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="kc">True</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-13">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-13">
        #
       </a>
      </div>
      <p>
       The send_message function sends a message to the Discord channel.
      </p>
      <p>
       <b>Args:</b><br>
self: Gives access to the class' attributes and methods.
command (str): The command to send
token (Optional[sr]) = None: The token used the send the message (or None if it should be the token in self)
latest_message (Optional[dict]) = None: Used if the message should reply to another message.
channel_id (Optional[int]) = None: The channel id used the send the message (or None if it should be the channel id in self)
      </p>
      <p>
       <b>Returns:</b><br>
None
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">latest_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">channel_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-14">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-14">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="n">command</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"typing indicator"</span><span class="p">][</span><span class="s2">"enabled"</span><span class="p">]:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"https://discord.com/api/v9/channels/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_id</span> <span class="k">if</span> <span class="n">channel_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">channel_id</span><span class="si">}</span><span class="s2">/typing"</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"authorization"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">token</span><span class="p">},</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span>
                <span class="n">uniform</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"typing indicator"</span><span class="p">][</span><span class="s2">"minimum"</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"typing indicator"</span><span class="p">][</span><span class="s2">"maximum"</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"message delay"</span><span class="p">][</span><span class="s2">"enabled"</span><span class="p">]:</span>
            <span class="n">sleep</span><span class="p">(</span>
                <span class="n">uniform</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"message delay"</span><span class="p">][</span><span class="s2">"minimum"</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"message delay"</span><span class="p">][</span><span class="s2">"maximum"</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"https://discord.com/api/v10/channels/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_id</span> <span class="k">if</span> <span class="n">channel_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">channel_id</span><span class="si">}</span><span class="s2">/messages?limit=1"</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"authorization"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">token</span><span class="p">},</span>
                <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">"content"</span><span class="p">:</span> <span class="n">command</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">latest_message</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="s2">"content"</span><span class="p">:</span> <span class="n">command</span><span class="p">,</span>
                    <span class="s2">"message_reference"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"guild_id"</span><span class="p">:</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"guild_id"</span><span class="p">],</span>
                        <span class="s2">"channel_id"</span><span class="p">:</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"channel_id"</span><span class="p">],</span>
                        <span class="s2">"message_id"</span><span class="p">:</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"id"</span><span class="p">],</span>
                    <span class="p">},</span>
                <span class="p">},</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="mi">199</span> <span class="o">&lt;</span> <span class="n">req</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"debug"</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="s2">"pls"</span> <span class="ow">in</span> <span class="n">command</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">][</span><span class="s2">"commands_ran"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="s2">"DEBUG"</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">"Successfully sent </span><span class="si">{</span><span class="s1">'command'</span> <span class="k">if</span> <span class="s1">'pls'</span> <span class="ow">in</span> <span class="n">command</span> <span class="k">else</span> <span class="s1">'message'</span><span class="si">}</span><span class="s2"> `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">`."</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="s2">"WARNING"</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">"Discord is ratelimiting the self-bot. Sleeping for </span><span class="si">{</span><span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">'retry_after'</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'second'</span> <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">'retry_after'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">'seconds'</span><span class="si">}</span><span class="s2">."</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">sleep</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s2">"retry_after"</span><span class="p">])</span>
                    <span class="k">continue</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="s2">"WARNING"</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">"Failed to send </span><span class="si">{</span><span class="s1">'command'</span> <span class="k">if</span> <span class="s1">'pls'</span> <span class="ow">in</span> <span class="n">command</span> <span class="k">else</span> <span class="s1">'message'</span><span class="si">}</span><span class="s2"> `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">`. Status code: </span><span class="si">{</span><span class="n">req</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> (expected 200 or 204)."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">MessageSendError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Failed to send </span><span class="si">{</span><span class="s1">'command'</span> <span class="k">if</span> <span class="s1">'pls'</span> <span class="ow">in</span> <span class="n">command</span> <span class="k">else</span> <span class="s1">'message'</span><span class="si">}</span><span class="s2"> `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">`. Status code: </span><span class="si">{</span><span class="n">req</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> (expected 200 or 204)."</span>
                <span class="p">)</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-15">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-15">
        #
       </a>
      </div>
      <p>
       The webhook_send function sends a webhook to the channel specified by self.channel_id with the given payload.
If Discord is ratelimiting the bot, it will sleep for
       <code>req.content['retry_after'] / 1000</code>   seconds and then try again.
      </p>
      <p>
       <b>Args:</b><br>
self: Gives access to the class' attributes and methods.
payload (dict): The webhook to be sent
fallback_message (str): The message to be sent if there is an error sending the webhook (usually if missing permissions). This may be removed in future versions
      </p>
      <p>
       <b>Returns:</b><br>
bool: Indicates whether the subprogram executed successfully or not
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>    <span class="k">def</span> <span class="nf">webhook_send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">fallback_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-16">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-16">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"https://discord.com/api/v9/channels/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_id</span><span class="si">}</span><span class="s2">/webhooks"</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"authorization"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">204</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="s2">"WARNING"</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">"Cannot send webhook in channel </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_id</span><span class="si">}</span><span class="s2"> - Missing Permissions. Resorting to normal message."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fallback_message</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="s2">"embeds"</span> <span class="ow">in</span> <span class="n">payload</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"footer"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"text"</span><span class="p">:</span> <span class="s2">"Bot made by didlly#0302 - https://www.github.com/didlly"</span><span class="p">,</span>
                <span class="s2">"icon_url"</span><span class="p">:</span> <span class="s2">"https://avatars.githubusercontent.com/u/94558954"</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"token"</span><span class="p">]</span>
            <span class="n">channel_id</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"id"</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"https://discord.com/api/v9/channels/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_id</span><span class="si">}</span><span class="s2">/webhooks"</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"authorization"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">},</span>
                <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Spidey Bot"</span><span class="p">},</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s2">"token"</span><span class="p">]</span>

            <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"https://discord.com/api/v9/channels/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_id</span><span class="si">}</span><span class="s2">/webhooks"</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"authorization"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="n">channel_id</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"id"</span><span class="p">]</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"https://discord.com/api/webhooks/</span><span class="si">{</span><span class="n">channel_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"authorization"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">},</span>
                <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="mi">199</span> <span class="o">&lt;</span> <span class="n">req</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"debug"</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="s2">"DEBUG"</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">"Successfully sent webhook `</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">`."</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"warning"</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="s2">"WARNING"</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">"Failed to send webhook `</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">`. Status code: </span><span class="si">{</span><span class="n">req</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> (expected 200 or 204)."</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"warning"</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                            <span class="s2">"WARNING"</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">"Discord is ratelimiting the self-bot. Sleeping for </span><span class="si">{</span><span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">'retry_after'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'second'</span> <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">'retry_after'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">'seconds'</span><span class="si">}</span><span class="s2">."</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">sleep</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s2">"retry_after"</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">raise</span> <span class="n">WebhookSendError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Failed to send webhook `</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">`. Status code: </span><span class="si">{</span><span class="n">req</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> (expected 200 or 204)."</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-17">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-17">
        #
       </a>
      </div>
      <p>
       The retreive_message function is used to retrieve the latest message from a Discord channel.
      </p>
      <p>
       Parameters:
      </p>
      <p>
       command (str): The command that was sent to Dank Memer.
      </p>
      <p>
       token (Optional[str]): The token used to retreive the message (or None if if it should be the token in self)
      </p>
      <p>
       check (bool): Whether or not this function should check for cooldowns and other restrictions in Dank Memer's response before returning it as a dict. Defaults to True, which means it will check for these restrictions and return an error if they are detected; False means no checks will be performed on the response at all, allowing you more control over what is returned by this function without having to manually parse each message yourself.
      </p>
      <p>
       <b>Args:</b><br>
self: Gives access to the class' attributes and methods.
command (str): The command the latest message is being retreived for.
token (Optional[str]) = None: The token used to retreive the message (or None if if it should be the token in self)
check (bool) = True: Determine whether or not the function should check for restrictions in the response from Dank Memer
old_latest_message (Optional[dict]) = None: Prevent the bot from getting stuck in an infinite loop or getting the wrong latest message if it can't find a response to its request
      </p>
      <p>
       <b>Returns:</b><br>
The latest message in the channel
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>    <span class="k">def</span> <span class="nf">retreive_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">old_latest_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-18">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-18">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">old_latest_message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">copy</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"channels"</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_id</span><span class="p">][</span><span class="s2">"message"</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">old_latest_message</span> <span class="o">==</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">old_latest_message</span>
            <span class="p">)</span>

            <span class="k">while</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span>
                <span class="s2">"settings"</span>
            <span class="p">][</span><span class="s2">"timeout"</span><span class="p">]:</span>
                <span class="n">latest_message</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"channels"</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_id</span><span class="p">][</span><span class="s2">"message"</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">old_latest_message</span> <span class="o">==</span> <span class="n">latest_message</span><span class="p">:</span>
                    <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"settings"</span><span class="p">][</span><span class="s2">"timeout"</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="s2">"referenced_message"</span> <span class="ow">in</span> <span class="n">latest_message</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"referenced_message"</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">latest_message</span><span class="p">[</span><span class="s2">"referenced_message"</span><span class="p">][</span><span class="s2">"author"</span><span class="p">][</span><span class="s2">"id"</span><span class="p">]</span>
                            <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
                            <span class="ow">and</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"author"</span><span class="p">][</span><span class="s2">"id"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"270904126974590976"</span>
                            <span class="ow">and</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"referenced_message"</span><span class="p">][</span><span class="s2">"content"</span><span class="p">]</span>
                            <span class="o">==</span> <span class="n">command</span>
                        <span class="p">):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"debug"</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                                    <span class="s2">"DEBUG"</span><span class="p">,</span>
                                    <span class="sa">f</span><span class="s2">"Got Dank Memer's response to command `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">`."</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="k">break</span>
                    <span class="k">elif</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"author"</span><span class="p">][</span><span class="s2">"id"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"270904126974590976"</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"debug"</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                                <span class="s2">"DEBUG"</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">"Got Dank Memer's response to command `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">`."</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">elif</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"author"</span><span class="p">][</span><span class="s2">"id"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"270904126974590976"</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"debug"</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                            <span class="s2">"DEBUG"</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">"Got Dank Memer's response to command `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">`."</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">break</span>

                <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"settings"</span><span class="p">][</span><span class="s2">"timeout"</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
                <span class="n">old_latest_message</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">latest_message</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"author"</span><span class="p">][</span><span class="s2">"id"</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">"270904126974590976"</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ResponseTimeout</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Timeout exceeded for response from Dank Memer (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'settings'</span><span class="p">][</span><span class="s1">'timeout'</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'second'</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'settings'</span><span class="p">][</span><span class="s1">'timeout'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">'seconds'</span><span class="si">}</span><span class="s2">). Aborting command."</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">"description"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">break</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="s2">"The default cooldown is"</span>
                    <span class="ow">not</span> <span class="ow">in</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="k">break</span>

                <span class="n">cooldown</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="nb">filter</span><span class="p">(</span>
                            <span class="nb">str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">,</span>
                            <span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span>
                            <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"**"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"**"</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"warning"</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="s2">"WARNING"</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">"Detected cooldown in Dank Memer's response to `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">`. Sleeping for </span><span class="si">{</span><span class="n">cooldown</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'second'</span> <span class="k">if</span> <span class="n">cooldown</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">'seconds'</span><span class="si">}</span><span class="s2">."</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">sleep</span><span class="p">(</span><span class="n">cooldown</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">token</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">latest_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retreive_message</span><span class="p">(</span>
                    <span class="n">command</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">check</span><span class="p">,</span> <span class="n">old_latest_message</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="s2">"title"</span> <span class="ow">in</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="ow">and</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">"title"</span><span class="p">]</span>
            <span class="ow">in</span> <span class="p">[</span><span class="s2">"You're currently bot banned!"</span><span class="p">,</span> <span class="s2">"You're currently blacklisted!"</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="s2">"ERROR"</span><span class="p">,</span>
                <span class="s2">"Exiting self-bot instance since Grank has detected the user has been bot banned / blacklisted."</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"auto trade"</span><span class="p">][</span><span class="s2">"enabled"</span><span class="p">]</span> <span class="ow">and</span> <span class="n">check</span><span class="p">:</span>
            <span class="n">old_latest_message</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">latest_message</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"auto trade"</span><span class="p">]:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">key</span> <span class="o">==</span> <span class="s2">"enabled"</span>
                    <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">"trader token"</span>
                    <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"auto trade"</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"content"</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="ow">in</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="p">):</span>
                        <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">"DEBUG"</span><span class="p">,</span> <span class="s2">"Received an item to be autotraded."</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"pls trade 1, 1 </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> &lt;@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&gt;"</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"auto trade"</span><span class="p">][</span><span class="s2">"trader token"</span><span class="p">],</span>
                    <span class="p">)</span>

                    <span class="n">latest_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retreive_message</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"pls trade 1, 1 </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> &lt;@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&gt;"</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"auto trade"</span><span class="p">][</span><span class="s2">"trader token"</span><span class="p">],</span>
                        <span class="kc">False</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">latest_message</span><span class="p">[</span><span class="s2">"content"</span><span class="p">]</span>
                        <span class="o">==</span> <span class="s2">"You have 0 coins, you can't give them 1."</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">"pls with 1"</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"auto trade"</span><span class="p">][</span><span class="s2">"trader token"</span><span class="p">],</span>
                        <span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">"pls trade 1, 1 </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> &lt;@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&gt;"</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"auto trade"</span><span class="p">][</span><span class="s2">"trader token"</span><span class="p">],</span>
                        <span class="p">)</span>

                        <span class="n">latest_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retreive_message</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">"pls trade 1, 1 </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> &lt;@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&gt;"</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"auto trade"</span><span class="p">][</span><span class="s2">"trader token"</span><span class="p">],</span>
                            <span class="kc">False</span><span class="p">,</span>
                        <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">interact_button</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"pls trade 1, 1 </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> &lt;@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&gt;"</span><span class="p">,</span>
                        <span class="n">latest_message</span><span class="p">[</span><span class="s2">"components"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">"components"</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"custom_id"</span><span class="p">],</span>
                        <span class="n">latest_message</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"auto trade"</span><span class="p">][</span><span class="s2">"trader token"</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">trader_token_session_id</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                    <span class="n">latest_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retreive_message</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"pls trade 1, 1 </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> &lt;@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&gt;"</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span>
                    <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">interact_button</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"pls trade 1, 1 </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> &lt;@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&gt;"</span><span class="p">,</span>
                        <span class="n">latest_message</span><span class="p">[</span><span class="s2">"components"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">"components"</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"custom_id"</span><span class="p">],</span>
                        <span class="n">latest_message</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="k">return</span> <span class="n">old_latest_message</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"auto sell"</span><span class="p">][</span><span class="s2">"enabled"</span><span class="p">]</span> <span class="ow">and</span> <span class="n">check</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"auto sell"</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">"enabled"</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"auto sell"</span><span class="p">][</span><span class="n">key</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"content"</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="ow">in</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="p">):</span>
                        <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"pls sell </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">latest_message</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-19">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-19">
        #
       </a>
      </div>
      <p>
       The fallback_retreive_message function is a helper function that is used to retreive the latest message sent by Dank Memer from the Discord channel.
It does this by making an API call to Discord's servers, and then parsing through all of the messages in order to find one that matches our criteria.
The criteria for this function is as follows:
      </p>
      <p>
       1) The message must be sent by Dank Memer. This ensures we don't get any false positives from other bots or users.
2) The command must be referenced in the embed title field of said message (e.g.,
       <code>pls stream</code>). This ensures we don't get any false negatives from other commands with similar names or unrelated errors/warnings/notifications.
      </p>
      <p>
       <b>Args:</b><br>
self: Gives access to the class' attributes and methods.
command (str): The command the latest message is being retreived for
      </p>
      <p>
       <b>Returns:</b><br>
The latest message sent by Dank Memer in the channel
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>    <span class="k">def</span> <span class="nf">fallback_retreive_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-20">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-20">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"https://discord.com/api/v10/channels/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_id</span><span class="si">}</span><span class="s2">/messages"</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"authorization"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">latest_message</span> <span class="ow">in</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"author"</span><span class="p">][</span><span class="s2">"id"</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">"270904126974590976"</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">command</span> <span class="o">!=</span> <span class="s2">"pls stream"</span>
                <span class="ow">and</span> <span class="s2">"referenced_message"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">latest_message</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="s2">"referenced_message"</span> <span class="ow">in</span> <span class="n">latest_message</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">latest_message</span><span class="p">[</span><span class="s2">"referenced_message"</span><span class="p">][</span><span class="s2">"author"</span><span class="p">][</span><span class="s2">"id"</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
                    <span class="ow">or</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"referenced_message"</span><span class="p">][</span><span class="s2">"content"</span><span class="p">]</span> <span class="o">!=</span> <span class="n">command</span>
                <span class="p">):</span>
                    <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="s2">"title"</span> <span class="ow">in</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="ow">and</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">"title"</span><span class="p">]</span>
                <span class="ow">in</span> <span class="p">[</span><span class="s2">"You're currently bot banned!"</span><span class="p">,</span> <span class="s2">"You're currently blacklisted!"</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="s2">"ERROR"</span><span class="p">,</span>
                    <span class="s2">"Exiting self-bot instance since Grank has detected the user has been bot banned / blacklisted."</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">"description"</span> <span class="ow">in</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="s2">"The default cooldown is"</span>
                        <span class="ow">in</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">cooldown</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                            <span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                <span class="nb">filter</span><span class="p">(</span>
                                    <span class="nb">str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">,</span>
                                    <span class="n">latest_message</span><span class="p">[</span><span class="s2">"embeds"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span>
                                    <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"**"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                                    <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"**"</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                            <span class="s2">"WARNING"</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">"Detected cooldown in Dank Memer's response to `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">`. Sleeping for </span><span class="si">{</span><span class="n">cooldown</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'second'</span> <span class="k">if</span> <span class="n">cooldown</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">'seconds'</span><span class="si">}</span><span class="s2">."</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">sleep</span><span class="p">(</span><span class="n">cooldown</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
                        <span class="n">latest_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retreive_message</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">latest_message</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-21">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-21">
        #
       </a>
      </div>
      <p>
       The interact_button function sends a POST request to the Discord API, which interacts with a button on Dank Memer's response.
      </p>
      <p>
       Parameters:
      </p>
      <p>
       command (str): The name of the command that was sent to Discord. This is used for logging purposes only.
      </p>
      <p>
       custom_id (int): The ID of the button that should be interacted with on Dank Memer's response message.
      </p>
      <p>
       latest_message (dict): The message the button to be interacted with is on.
      </p>
      <p>
       token (Optional[str]): The token used to retreive the message (or None if if it should be the token in self)
      </p>
      <p>
       <b>Args:</b><br>
self: Gives access to the class' attributes and methods.
command (str): The command is being interacted with
custom_id (int): The ID of the button that should be interacted with
latest_message (dict): The message the button to be interacted with is on.
token (Optional[str]) = None: Pass the token to the function
session_id (Optional[str]) = None: The sesion id of the account that is interacting with the button.
      </p>
      <p>
       <b>Returns:</b><br>
Nothing
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>    <span class="k">def</span> <span class="nf">interact_button</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">custom_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">latest_message</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">session_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-22">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-22">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"application_id"</span><span class="p">:</span> <span class="mi">270904126974590976</span><span class="p">,</span>
            <span class="s2">"channel_id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_id</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"component_type"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"custom_id"</span><span class="p">:</span> <span class="n">custom_id</span><span class="p">},</span>
            <span class="s2">"guild_id"</span><span class="p">:</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"message_reference"</span><span class="p">][</span><span class="s2">"guild_id"</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">"message_reference"</span> <span class="ow">in</span> <span class="n">latest_message</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">guild_id</span><span class="p">,</span>
            <span class="s2">"message_flags"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">"message_id"</span><span class="p">:</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"id"</span><span class="p">],</span>
            <span class="s2">"session_id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span> <span class="k">if</span> <span class="n">session_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">session_id</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"button delay"</span><span class="p">][</span><span class="s2">"enabled"</span><span class="p">]:</span>
            <span class="n">sleep</span><span class="p">(</span>
                <span class="n">uniform</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"button delay"</span><span class="p">][</span><span class="s2">"minimum"</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"button delay"</span><span class="p">][</span><span class="s2">"maximum"</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span>
                <span class="s2">"https://discord.com/api/v10/interactions"</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"authorization"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">token</span><span class="p">},</span>
                <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="mi">199</span> <span class="o">&lt;</span> <span class="n">req</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"debug"</span><span class="p">]:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">][</span><span class="s2">"buttons_clicked"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="s2">"DEBUG"</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">"Successfully interacted with button on Dank Memer's response to command `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">`."</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"warning"</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                            <span class="s2">"WARNING"</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">"Discord is ratelimiting the self-bot. Sleeping for </span><span class="si">{</span><span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">'retry_after'</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'second'</span> <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">'retry_after'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">'seconds'</span><span class="si">}</span><span class="s2">."</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">sleep</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s2">"retry_after"</span><span class="p">])</span>

                    <span class="k">continue</span>

                <span class="k">raise</span> <span class="n">ButtonInteractError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Failed to interact with button on Dank Memer's response to command `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">`. Status code: </span><span class="si">{</span><span class="n">req</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> (expected 200 or 204)."</span>
                <span class="p">)</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-23">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-23">
        #
       </a>
      </div>
      <p>
       The interact_dropdown function is used to interact with a dropdown menu on Dank Memer's response to a command.
      </p>
      <p>
       Parameters:
      </p>
      <p>
       self (DiscordSelfbot): The DiscordSelfbot instance that is calling the function.
      </p>
      <p>
       command (str): The name of the command that was called
      </p>
      <p>
       custom_id (int): A unique ID of the dropdown to be selected.
      </p>
      <p>
       <b>Args:</b><br>
self: Gives access to the class' attributes and methods.
command (str): The command is being interacted with
custom_id (int): The ID of the button that should be interacted with
option_id (str): The ID of the dropdown that should be selected
latest_message (dict): The message the button to be interacted with is on.
      </p>
      <p>
       <b>Returns:</b><br>
None
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>    <span class="k">def</span> <span class="nf">interact_dropdown</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">custom_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">option_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">latest_message</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">):</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-24">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-24">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"application_id"</span><span class="p">:</span> <span class="mi">270904126974590976</span><span class="p">,</span>
            <span class="s2">"channel_id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_id</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"component_type"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s2">"custom_id"</span><span class="p">:</span> <span class="n">custom_id</span><span class="p">,</span>
                <span class="s2">"type"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s2">"values"</span><span class="p">:</span> <span class="p">[</span><span class="n">option_id</span><span class="p">],</span>
            <span class="p">},</span>
            <span class="s2">"guild_id"</span><span class="p">:</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"message_reference"</span><span class="p">][</span><span class="s2">"guild_id"</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">"message_reference"</span> <span class="ow">in</span> <span class="n">latest_message</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">guild_id</span><span class="p">,</span>
            <span class="s2">"message_flags"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">"message_id"</span><span class="p">:</span> <span class="n">latest_message</span><span class="p">[</span><span class="s2">"id"</span><span class="p">],</span>
            <span class="s2">"session_id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"dropdown delay"</span><span class="p">][</span><span class="s2">"enabled"</span><span class="p">]:</span>
            <span class="n">sleep</span><span class="p">(</span>
                <span class="n">uniform</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"dropdown delay"</span><span class="p">][</span><span class="s2">"minimum"</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"dropdown delay"</span><span class="p">][</span><span class="s2">"maximum"</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span>
                <span class="s2">"https://discord.com/api/v10/interactions"</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"authorization"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">},</span>
                <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="mi">199</span> <span class="o">&lt;</span> <span class="n">req</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"debug"</span><span class="p">]:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">"stats"</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">][</span><span class="s2">"dropdowns_selected"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="s2">"DEBUG"</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">"Successfully interacted with dropdown on Dank Memer's response to command `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">`."</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"warning"</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                            <span class="s2">"WARNING"</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">"Discord is ratelimiting the self-bot. Sleeping for </span><span class="si">{</span><span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">'retry_after'</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'second'</span> <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">'retry_after'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">'seconds'</span><span class="si">}</span><span class="s2">."</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">sleep</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s2">"retry_after"</span><span class="p">])</span>

                    <span class="k">continue</span>
                <span class="k">raise</span> <span class="n">DropdownInteractError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Failed to interact with dropdown on Dank Memer's response to command `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">`. Status code: </span><span class="si">{</span><span class="n">req</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> (expected 200 or 204)."</span>
                <span class="p">)</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-25">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-25">
        #
       </a>
      </div>
      <p>
       The clear_lag function is used to stop possible backlash from Dank Memer commands. It does this
by finding the latest message from Dank Memer and interacting with the last button on the first row,
although this can be changed
      </p>
      <p>
       <b>Args:</b><br>
self: Gives access to the class' attributes and methods.
command (str): Specify which button to interact with
index1 (int) = 0: Specify the index of the first component in a message
index2 (int) = -1: Specify the index of the button in the message
      </p>
      <p>
       <b>Returns:</b><br>
None
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>    <span class="k">def</span> <span class="nf">clear_lag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">index2</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-26">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-26">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"https://discord.com/api/v10/channels/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_id</span><span class="si">}</span><span class="s2">/messages"</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"authorization"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">message</span><span class="p">[</span><span class="s2">"author"</span><span class="p">][</span><span class="s2">"id"</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">"270904126974590976"</span>
                <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s2">"components"</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">custom_id</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s2">"components"</span><span class="p">][</span><span class="n">index1</span><span class="p">][</span><span class="s2">"components"</span><span class="p">][</span><span class="n">index2</span><span class="p">][</span>
                        <span class="s2">"custom_id"</span>
                    <span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interact_button</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">custom_id</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="n">ButtonInteractError</span><span class="p">:</span>
                    <span class="k">continue</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-27">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-27">
        #
       </a>
      </div>
      <p>
       The log function is used to log messages.
      </p>
      <p>
       <b>Args:</b><br>
self: Gives access to the class' attributes and methods.
level (str): The level of the log message
text (str): The log message
      </p>
      <p>
       <b>Returns:</b><br>
None
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-28">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-28">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="k">if</span> <span class="s2">"Repository"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s2">"DEBUG"</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"debug"</span><span class="p">]:</span>
                <span class="k">return</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">level</span> <span class="o">==</span> <span class="s2">"WARNING"</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"warning"</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="k">return</span>

        <span class="n">time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"[</span><span class="si">%x</span><span class="s2">-</span><span class="si">%X</span><span class="s2">]"</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">time</span><span class="si">}{</span><span class="sa">f</span><span class="s1">' - </span><span class="si">{</span><span class="n">fore</span><span class="o">.</span><span class="n">Bright_Magenta</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}{</span><span class="n">style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="si">}</span><span class="s1">'</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">''</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">style</span><span class="o">.</span><span class="n">Italic</span><span class="si">}{</span><span class="n">fore</span><span class="o">.</span><span class="n">Bright_Red</span> <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s1">'ERROR'</span> <span class="k">else</span> <span class="n">fore</span><span class="o">.</span><span class="n">Bright_Blue</span> <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s1">'DEBUG'</span> <span class="k">else</span> <span class="n">fore</span><span class="o">.</span><span class="n">Bright_Yellow</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">time</span><span class="si">}{</span><span class="sa">f</span><span class="s1">' - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s1">'</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">''</span><span class="si">}</span><span class="s2"> - [</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2">] | </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s2">"ERROR"</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">style</span><span class="o">.</span><span class="n">Italic</span> <span class="ow">and</span> <span class="n">style</span><span class="o">.</span><span class="n">Faint</span><span class="si">}</span><span class="s2">Press ENTER to exit the program...</span><span class="si">{</span><span class="n">style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
            <span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-29">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-29">
        #
       </a>
      </div>
      <p>
       The webhook_log function is used to send a webhook log to the webhook logging URL
      </p>
      <p>
       <b>Args:</b><br>
self: Gives access to the class' attributes and methods.
payload (dict): The data to be sent to the webhook
      </p>
      <p>
       <b>Returns:</b><br>
None
      </p>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>    <span class="k">def</span> <span class="nf">webhook_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span></pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
    <div class="section" id="section-30">
     <div class="docs">
      <div class="octowrap">
       <a class="octothorpe" href="#section-30">
        #
       </a>
      </div>
     </div>
     <div class="code">
      <div class="highlight">
       <pre>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"webhook logging"</span><span class="p">][</span><span class="s2">"enabled"</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"webhook logging"</span><span class="p">][</span><span class="s2">"url"</span><span class="p">],</span>
                <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="mi">199</span> <span class="o">&lt;</span> <span class="n">req</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"debug"</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="s2">"DEBUG"</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">"Successfully sent webhook `</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">`."</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"warning"</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="s2">"WARNING"</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">"Failed to send webhook `</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">`. Status code: </span><span class="si">{</span><span class="n">req</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> (expected 200 or 204)."</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Repository</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"logging"</span><span class="p">][</span><span class="s2">"warning"</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                            <span class="s2">"WARNING"</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">"Discord is ratelimiting the self-bot. Sleeping for </span><span class="si">{</span><span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">'retry_after'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'second'</span> <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">'retry_after'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">'seconds'</span><span class="si">}</span><span class="s2">."</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">sleep</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s2">"retry_after"</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">raise</span> <span class="n">WebhookSendError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Failed to send webhook `</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">`. Status code: </span><span class="si">{</span><span class="n">req</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> (expected 200 or 204)."</span>
                <span class="p">)</span>

</pre>
      </div>
     </div>
    </div>
    <div class="clearall">
    </div>
   </div>
  </div>
 </body>
</html>